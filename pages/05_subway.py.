import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
from datetime import datetime

st.set_page_config(page_title="Subway Top10 OCT 2025", layout="wide")
st.title("ğŸš‡ 2025ë…„ 10ì›” ì§€í•˜ì²  ìƒìœ„ 10ê°œ ì—­ ìŠ¹í•˜ì°¨ ë¶„ì„")

st.sidebar.header("ğŸ“ ë°ì´í„° ì—…ë¡œë“œ")
uploaded = st.sidebar.file_uploader("CSV íŒŒì¼ ì—…ë¡œë“œ", type=["csv"])

if uploaded is None:
    st.warning("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.")
    st.stop()

@st.cache_data(ttl=600)
def load_data(file):
    try:
        return pd.read_csv(file, encoding="utf-8")
    except:
        return pd.read_csv(file, encoding="cp949")

df = load_data(uploaded)

required = ["ì‚¬ìš©ì¼ì", "ë…¸ì„ ëª…", "ì—­ëª…", "ìŠ¹ì°¨ì´ìŠ¹ê°ìˆ˜", "í•˜ì°¨ì´ìŠ¹ê°ìˆ˜"]
for c in required:
    if c not in df.columns:
        st.error(f"âŒ '{c}' ì»¬ëŸ¼ì´ ì—†ìŒ â€” CSV í™•ì¸í•´ì¤˜")
        st.stop()

df["ì‚¬ìš©ì¼ì"] = pd.to_datetime(df["ì‚¬ìš©ì¼ì"].astype(str), format="%Y%m%d", errors="coerce")
df["ìŠ¹í•˜í•©ê³„"] = df["ìŠ¹ì°¨ì´ìŠ¹ê°ìˆ˜"] + df["í•˜ì°¨ì´ìŠ¹ê°ìˆ˜"]
df["ì—­í‘œì‹œ"] = df["ì—­ëª…"]()

